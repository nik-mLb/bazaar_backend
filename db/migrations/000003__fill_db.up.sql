-- Вставка адресов
INSERT INTO bazaar.address (id, region, city, address_string, coordinate)
VALUES
    ('550e8400-e29b-41d4-a716-446655440201', 'Центральный', 'Москва', 'ул. Ленина, д. 1', '55.7558,37.6176'),
    ('550e8400-e29b-41d4-a716-446655440202', 'Северо-Западный', 'Санкт-Петербург', 'Невский пр., д. 10', '59.9311,30.3609'),
    ('550e8400-e29b-41d4-a716-446655440203', 'Приволжский', 'Казань', 'ул. Баумана, д. 5', '55.7963,49.1088');

-- Вставка ПВЗ
INSERT INTO bazaar.pickup_point (id, address_id)
VALUES
    ('550e8400-e29b-41d4-a716-446655440040', '550e8400-e29b-41d4-a716-446655440201'),
    ('550e8400-e29b-41d4-a716-446655440041', '550e8400-e29b-41d4-a716-446655440202'),
    ('550e8400-e29b-41d4-a716-446655440042', '550e8400-e29b-41d4-a716-446655440203');

-- Вставка пользователей
INSERT INTO bazaar."user" (id, email, phone_number, password_hash, name, role)
VALUES ('e29b41d4-a716-4466-5544-000000000001', 'user1@example.com', '+1234567890', 'hash1', 'Иван', 'seller'),
       ('e29b41d4-a716-4466-5544-000000000002', 'user2@example.com', '+1234567891', 'hash2', 'Петр', 'buyer'),
       ('e29b41d4-a716-4466-5544-000000000010', 'seller8@example.com', '+1234567899', 'hash10', 'Андрей', 'admin');

INSERT INTO bazaar.seller (id, title, description, user_id) 
VALUES ('e29b41d4-a716-4466-5544-000000000004','Продавец Bazaar','Я тут главный','e29b41d4-a716-4466-5544-000000000001');

INSERT INTO bazaar."user" (id, email, password_hash, name, role)
VALUES ('e29b41d4-a716-4466-5544-000000000003', 'admin@admin.ru', '$2a$04$yX8uDBleszjVgx6dsVPt0uPv7K4dPc4bNz.1n5MD3RiTBeXKOh6oO', 'Админ', 'admin');

INSERT INTO bazaar."user" (id, email, password_hash, name, role)
VALUES ('e29b41d4-a716-4466-5544-000000000033', 'sklad@sklad.ru', '$2a$04$TyhWcYrtEhiuDwjNmKThwOQ3yXGZimdtrC3xXPru7byZ7Fwrj11Xa', 'Работник склада', 'warehouseman');

INSERT INTO bazaar.basket (id, user_id, total_price, total_price_discount)
VALUES ('e33b41d4-a716-4466-5544-000000000005', 'e29b41d4-a716-4466-5544-000000000003', 0, 0);

INSERT INTO bazaar.basket (id, user_id, total_price, total_price_discount)
VALUES ('e33b41d4-a716-4466-5544-000000000006', 'e29b41d4-a716-4466-5544-000000000033', 0, 0);

-- Вставка категорий
INSERT INTO bazaar.category (id, name)
VALUES ('550e8400-e29b-41d4-a716-446655440010', 'Электроника'),
       ('550e8400-e29b-41d4-a716-446655440011', 'Одежда'),
       ('550e8400-e29b-41d4-a716-446655440012', 'Дом и сад'),
       ('550e8400-e29b-41d4-a716-446655440014', 'Бытовая техника'),
       ('550e8400-e29b-41d4-a716-446655440015', 'Спорт и отдых'),
       ('550e8400-e29b-41d4-a716-446655440016', 'Строительство и ремонт');

INSERT INTO bazaar.subcategory (id, name, category_id)
VALUES 
       -- Электроника
    ('660e8400-e29b-41d4-a716-446655440001', 'Смартфоны', '550e8400-e29b-41d4-a716-446655440010'),
    ('660e8400-e29b-41d4-a716-446655440002', 'Наушники и аудио', '550e8400-e29b-41d4-a716-446655440010'),
    ('660e8400-e29b-41d4-a716-446655440003', 'Умные часы и браслеты', '550e8400-e29b-41d4-a716-446655440010'),
    ('660e8400-e29b-41d4-a716-446655440004', 'Гаджеты и аксессуары', '550e8400-e29b-41d4-a716-446655440010'),
    ('660e8400-e29b-41d4-a716-446655440005', 'Компьютеры и переферия', '550e8400-e29b-41d4-a716-446655440010'),
    ('660e8400-e29b-41d4-a716-446655440006', 'Ноутбуки, планшеты и электронные книги', '550e8400-e29b-41d4-a716-446655440010'),

    -- Одежда
    ('660e8400-e29b-41d4-a716-446655440007', 'Верхняя одежда', '550e8400-e29b-41d4-a716-446655440011'),
    ('660e8400-e29b-41d4-a716-446655440008', 'Брюки', '550e8400-e29b-41d4-a716-446655440011'),
    ('660e8400-e29b-41d4-a716-446655440009', 'Джинсы', '550e8400-e29b-41d4-a716-446655440011'),
    ('660e8400-e29b-41d4-a716-446655440010', 'Футболки и рубашки', '550e8400-e29b-41d4-a716-446655440011'),
    ('660e8400-e29b-41d4-a716-446655440037', 'Детям', '550e8400-e29b-41d4-a716-446655440011'),

    -- Дом и сад
    ('660e8400-e29b-41d4-a716-446655440011', 'Посуда', '550e8400-e29b-41d4-a716-446655440012'),
    ('660e8400-e29b-41d4-a716-446655440012', 'Дача и сад', '550e8400-e29b-41d4-a716-446655440012'),
    ('660e8400-e29b-41d4-a716-446655440013', 'Текстиль', '550e8400-e29b-41d4-a716-446655440012'),
    ('660e8400-e29b-41d4-a716-446655440014', 'Декор и интерьер', '550e8400-e29b-41d4-a716-446655440012'),
    ('660e8400-e29b-41d4-a716-446655440015', 'Товары для праздников', '550e8400-e29b-41d4-a716-446655440012'),

    -- Бытовая техника
    ('660e8400-e29b-41d4-a716-446655440022', 'Крупная бытовая техника', '550e8400-e29b-41d4-a716-446655440014'),
    ('660e8400-e29b-41d4-a716-446655440023', 'Техника для дома', '550e8400-e29b-41d4-a716-446655440014'),
    ('660e8400-e29b-41d4-a716-446655440024', 'Мелкая кухонная техника', '550e8400-e29b-41d4-a716-446655440014'),
    ('660e8400-e29b-41d4-a716-446655440025', 'Климатическая техника', '550e8400-e29b-41d4-a716-446655440014'),

    -- Спорт и отдых
    ('660e8400-e29b-41d4-a716-446655440026', 'Спортивное питание', '550e8400-e29b-41d4-a716-446655440015'),
    ('660e8400-e29b-41d4-a716-446655440027', 'Тренажеры', '550e8400-e29b-41d4-a716-446655440015'),
    ('660e8400-e29b-41d4-a716-446655440028', 'Бег', '550e8400-e29b-41d4-a716-446655440015'),
    ('660e8400-e29b-41d4-a716-446655440029', 'Бокс', '550e8400-e29b-41d4-a716-446655440015'),
    ('660e8400-e29b-41d4-a716-446655440030', 'Велоспорт', '550e8400-e29b-41d4-a716-446655440015'),
    ('660e8400-e29b-41d4-a716-446655440031', 'Теннис и бадминтон', '550e8400-e29b-41d4-a716-446655440015'),

    -- Строительство и ремонт
    ('660e8400-e29b-41d4-a716-446655440032', 'Инструменты', '550e8400-e29b-41d4-a716-446655440016'),
    ('660e8400-e29b-41d4-a716-446655440033', 'Строительные материалы', '550e8400-e29b-41d4-a716-446655440016'),
    ('660e8400-e29b-41d4-a716-446655440034', 'Сантехника', '550e8400-e29b-41d4-a716-446655440016'),
    ('660e8400-e29b-41d4-a716-446655440035', 'Вентиляция', '550e8400-e29b-41d4-a716-446655440016'),
    ('660e8400-e29b-41d4-a716-446655440036', 'Электрика', '550e8400-e29b-41d4-a716-446655440016');

-- Вставка всех 15 товаров
INSERT INTO bazaar.product (id, seller_id, name, description, status, price, quantity, rating, reviews_count, preview_image_url)
VALUES 
  ('550e8400-e29b-41d4-a716-446655440001', 'e29b41d4-a716-4466-5544-000000000001', 'Смартфон Xiaomi Redmi Note 10',
   'Смартфон с AMOLED-дисплеем и камерой 48 Мп', 'approved', 19999.00, 50, 4, 120,
   'https://bazaar-techpark.ru/s3/ffe68ed9-de77-421e-800a-0df65e2de284'),
  
  ('550e8400-e29b-41d4-a716-446655440002', 'e29b41d4-a716-4466-5544-000000000001', 'Ноутбук ASUS VivoBook 15',
   'Ноутбук с процессором Intel Core i5 и SSD на 512 ГБ', 'approved', 54999.00, 30, 4, 80,
   'https://bazaar-techpark.ru/s3/f54c40e2-62b7-42a5-9530-2b6c90501d0e'),
  
  ('550e8400-e29b-41d4-a716-446655440003', 'e29b41d4-a716-4466-5544-000000000001', 'Наушники Sony WH-1000XM4',
   'Беспроводные наушники с шумоподавлением', 'approved', 29999.00, 25, 4, 200,
   'https://bazaar-techpark.ru/s3/0116edd7-a740-4ec4-9ecd-1675dff68d30'),
  
  ('550e8400-e29b-41d4-a716-446655440004', 'e29b41d4-a716-4466-5544-000000000001', 'Фитнес-браслет Xiaomi Mi Band 6',
   'Фитнес-браслет с AMOLED-дисплеем и мониторингом сна', 'approved', 3999.00, 100, 4, 300,
   'https://bazaar-techpark.ru/s3/39d009d8-7fd0-43cd-9e3d-c26a16dccd98'),
  
  ('550e8400-e29b-41d4-a716-446655440005', 'e29b41d4-a716-4466-5544-000000000001', 'Пылесос Dyson V11',
   'Беспроводной пылесос с мощным всасыванием', 'approved', 59999.00, 15, 4, 90,
   'https://bazaar-techpark.ru/s3/2667d585-9f3f-4584-8619-d65188a81562'),
  
  ('550e8400-e29b-41d4-a716-446655440006', 'e29b41d4-a716-4466-5544-000000000001', 'Кофемашина DeLonghi Magnifica',
   'Автоматическая кофемашина для приготовления эспрессо', 'approved', 79999.00, 10, 4, 70,
   'https://bazaar-techpark.ru/s3/0be59f96-e7c4-48b1-85c8-b12b9b8bcb94'),
  
  ('550e8400-e29b-41d4-a716-446655440007', 'e29b41d4-a716-4466-5544-000000000001', 'Электросамокат Xiaomi Mi Scooter 3',
   'Электросамокат с запасом хода 30 км', 'approved', 29999.00, 40, 4, 150,
   'https://bazaar-techpark.ru/s3/5d608a62-0e13-468b-acba-ee75d680a912'),
  
  ('550e8400-e29b-41d4-a716-446655440008', 'e29b41d4-a716-4466-5544-000000000001', 'Умная колонка Яндекс.Станция Мини',
   'Умная колонка с голосовым помощником Алисой', 'approved', 7999.00, 60, 4, 250,
   'https://bazaar-techpark.ru/s3/04cda51f-7b88-47f6-a4aa-dab52518c88b'),
  
  ('550e8400-e29b-41d4-a716-446655440009', 'e29b41d4-a716-4466-5544-000000000001', 'Монитор Samsung Odyssey G5',
   'Игровой монитор с разрешением 1440p и частотой 144 Гц', 'approved', 34999.00, 20, 4, 100,
   'https://bazaar-techpark.ru/s3/3c36a52e-15f6-43f7-8dbb-837a86502ce0'),
  
  ('550e8400-e29b-41d4-a716-446655440010', 'e29b41d4-a716-4466-5544-000000000001', 'Электрочайник Bosch TWK 3A011',
   'Электрочайник с мощностью 2400 Вт', 'approved', 1999.00, 50, 4, 180,
   'https://bazaar-techpark.ru/s3/b7499c98-2b54-4787-840c-d45bfa64bda1');

-- Вставка связи товаров с категориями
INSERT INTO bazaar.product_subcategory (id, product_id, subcategory_id)
VALUES ('550e8400-e29b-41d4-a716-446655440101', '550e8400-e29b-41d4-a716-446655440001',
        '660e8400-e29b-41d4-a716-446655440001'),
       ('550e8400-e29b-41d4-a716-446655440102', '550e8400-e29b-41d4-a716-446655440002',
        '660e8400-e29b-41d4-a716-446655440006'),
       ('550e8400-e29b-41d4-a716-446655440103', '550e8400-e29b-41d4-a716-446655440003',
        '660e8400-e29b-41d4-a716-446655440002'),
       ('550e8400-e29b-41d4-a716-446655440104', '550e8400-e29b-41d4-a716-446655440004',
        '660e8400-e29b-41d4-a716-446655440003'),
       ('550e8400-e29b-41d4-a716-446655440105', '550e8400-e29b-41d4-a716-446655440005',
        '660e8400-e29b-41d4-a716-446655440023'),
       ('550e8400-e29b-41d4-a716-446655440106', '550e8400-e29b-41d4-a716-446655440006',
        '660e8400-e29b-41d4-a716-446655440024'),
       ('550e8400-e29b-41d4-a716-446655440108', '550e8400-e29b-41d4-a716-446655440008',
        '660e8400-e29b-41d4-a716-446655440002'),
       ('550e8400-e29b-41d4-a716-446655440109', '550e8400-e29b-41d4-a716-446655440009',
        '660e8400-e29b-41d4-a716-446655440005'),
       ('550e8400-e29b-41d4-a716-446655440110', '550e8400-e29b-41d4-a716-446655440010',
        '660e8400-e29b-41d4-a716-446655440024');

-- Вставка отзывов
INSERT INTO bazaar.review (id, user_id, product_id, rating, comment)
VALUES ('550e8400-e29b-41d4-a716-446655440901', 'e29b41d4-a716-4466-5544-000000000001',
        '550e8400-e29b-41d4-a716-446655440001', 5, 'Отличный смартфон за свои деньги!'),
       ('550e8400-e29b-41d4-a716-446655440902', 'e29b41d4-a716-4466-5544-000000000001',
        '550e8400-e29b-41d4-a716-446655440003', 4, 'Хорошие наушники, но дороговаты'),
       ('550e8400-e29b-41d4-a716-446655440903', 'e29b41d4-a716-4466-5544-000000000002',
        '550e8400-e29b-41d4-a716-446655440005', 5, 'Лучший пылесос, который у меня был!'),
       ('550e8400-e29b-41d4-a716-446655440904', 'e29b41d4-a716-4466-5544-000000000002',
        '550e8400-e29b-41d4-a716-446655440008', 4, 'Хороший звук, удобное управление');

-- -- Вставка скидок
-- INSERT INTO bazaar.discount (id, start_date, end_date, product_id, discounted_price)
-- VALUES ('550e8400-e29b-41d4-a716-446655441001', NOW(), NOW() + INTERVAL '7 DAY', '550e8400-e29b-41d4-a716-446655440001',
--         17999.00),
--        ('550e8400-e29b-41d4-a716-446655441002', NOW(), NOW() + INTERVAL '14 DAY',
--         '550e8400-e29b-41d4-a716-446655440003', 26999.00),
--        ('550e8400-e29b-41d4-a716-446655441003', NOW(), NOW() + INTERVAL '10 DAY',
--         '550e8400-e29b-41d4-a716-446655440005', 54999.00);

INSERT INTO bazaar.topic (id, name)
VALUES
    ('00000000-0000-0000-0000-000000000001', 'Category'),
    ('00000000-0000-0000-0000-000000000002', 'Profile'),
    ('00000000-0000-0000-0000-000000000003', 'Cart'),
    ('00000000-0000-0000-0000-000000000004', 'Order'),
    ('00000000-0000-0000-0000-000000000005', 'Mainpage');

-- Опрос по "Выбор категории"
INSERT INTO bazaar.survey (id, topic_id, title, description)
VALUES ('10000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'Опрос по выбору категории', 'Пожалуйста, оцените процесс выбора категории.');

-- Опрос по "Профиль"
INSERT INTO bazaar.survey (id, topic_id, title, description)
VALUES ('20000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000002', 'Опрос по профилю', 'Пожалуйста, оцените работу с профилем.');

-- Опрос по "Корзина"
INSERT INTO bazaar.survey (id, topic_id, title, description)
VALUES ('30000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000003', 'Опрос по корзине', 'Пожалуйста, оцените удобство корзины.');

-- Опрос по "Заказы"
INSERT INTO bazaar.survey (id, topic_id, title, description)
VALUES ('40000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000004', 'Опрос по заказам', 'Пожалуйста, оцените оформление заказов.');

-- Опрос по "Основная страница"
INSERT INTO bazaar.survey (id, topic_id, title, description)
VALUES ('50000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000005', 'Опрос по главной странице', 'Пожалуйста, оцените главную страницу.');

-- Вопросы для опроса по основной странице
INSERT INTO bazaar.question (id, survey_id, text, position)
VALUES
    ('51000000-0000-0000-0000-000000000001', '50000000-0000-0000-0000-000000000001', 'Как бы вы оценили удобство навигации на главной странице?', 1),
    ('51000000-0000-0000-0000-000000000002', '50000000-0000-0000-0000-000000000001', 'Насколько легко вам было найти нужную информацию на главной странице?', 2),
    ('51000000-0000-0000-0000-000000000003', '50000000-0000-0000-0000-000000000001', 'Насколько привлекателен дизайн главной страницы?', 3);

-- Вопросы для опроса по выбору категории
INSERT INTO bazaar.question (id, survey_id, text, position)
VALUES
    ('11000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'Насколько удобен процесс выбора категории товаров?', 1),
    ('11000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000001', 'Насколько легко вам было найти нужную категорию товаров?', 2),
    ('11000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000001', 'Насколько хорошо организованы категории?', 3);

-- Вопросы для опроса по профилю
INSERT INTO bazaar.question (id, survey_id, text, position)
VALUES
    ('21000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001', 'Как бы вы оценили удобство редактирования профиля?', 1),
    ('21000000-0000-0000-0000-000000000002', '20000000-0000-0000-0000-000000000001', 'Насколько удобны функции профиля, такие как изменение данных и изменение аватарки?', 2);

-- Вопросы для опроса по корзине
INSERT INTO bazaar.question (id, survey_id, text, position)
VALUES
    ('31000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000001', 'Как бы вы оценили удобство использования корзины?', 1),
    ('31000000-0000-0000-0000-000000000002', '30000000-0000-0000-0000-000000000001', 'Насколько удобно добавлять и удалять товары из корзины?', 2),
    ('31000000-0000-0000-0000-000000000003', '30000000-0000-0000-0000-000000000001', 'Насколько понятна информация о товарах в корзине?', 3);

-- Вопросы для опроса по заказам
INSERT INTO bazaar.question (id, survey_id, text, position)
VALUES
    ('41000000-0000-0000-0000-000000000001', '40000000-0000-0000-0000-000000000001', 'Как бы вы оценили процесс оформления заказа?', 1),
    ('41000000-0000-0000-0000-000000000002', '40000000-0000-0000-0000-000000000001', 'Насколько понятен и удобен процесс отслеживания состояния заказа?', 2),
    ('41000000-0000-0000-0000-000000000003', '40000000-0000-0000-0000-000000000001', 'Насколько вы довольны сроками доставки?', 3),
    ('41000000-0000-0000-0000-000000000004', '40000000-0000-0000-0000-000000000001', 'Как бы вы оценили процесс оплаты?', 4);


-- Обновляем все продукты на основе реальных отзывов
UPDATE bazaar.product p
SET 
    reviews_count = subquery.review_count,
    rating = subquery.avg_rating
FROM (
    SELECT 
        product_id,
        COUNT(*) as review_count,
        COALESCE(AVG(rating), 0) as avg_rating
    FROM bazaar.review
    GROUP BY product_id
) subquery
WHERE p.id = subquery.product_id;

-- Для продуктов без отзывов устанавливаем значения по умолчанию
UPDATE bazaar.product
SET 
    reviews_count = 0,
    rating = 0
WHERE id NOT IN (SELECT product_id FROM bazaar.review);